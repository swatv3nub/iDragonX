from iDragonX import app
from config import PREFIX

from pyrogram import filters

from iDragonX.database.globalcmdsdb import get_gmuted_users, gmute_user, ungmute_user, get_gbanned_users, gban_user, ungban_user
from iDragonX.helpers.pyrohelper import get_arg
from iDragonX.helpers.adminhelpers import CheckAdmin

#gmute

@app.on_message(filters.command("gmute", PREFIX) & filters.me)
async def gmute(_, message):
    reply = message.reply_to_message
    if reply:
        user = reply.from_user["id"]
    else:
        user = get_arg(message)
        if not user:
            await message.edit("**Gmute Who?**")
            return
    get_user = await app.get_users(user)
    await gmute_user(get_user.id)
    await message.edit(f"**Gmuted {get_user.first_name}!**")


@app.on_message(filters.command("ungmute", PREFIX) & filters.me)
async def gmute(_, message):
    reply = message.reply_to_message
    if reply:
        user = reply.from_user["id"]
    else:
        user = get_arg(message)
        if not user:
            await message.edit("**Ungmute Who?**")
            return
    get_user = await app.get_users(user)
    await ungmute_user(get_user.id)
    await message.edit(f"**Ungmuted {get_user.first_name}!**")


@app.on_message(filters.group & filters.incoming)
async def check_and_del(client, message):
    if not message:
        return
    try:
        if not message.from_user.id in (await get_gmuted_users()):
            return
    except AttributeError:
        return
    message_id = message.message_id
    try:
        await app.delete_messages(message.chat.id, message_id)
    except:
        pass

#gban

app.on_message(filters.command("gban", PREFIX) & filters.me)
async def gban(_, message):
    reply = message.reply_to_message
    if reply:
        user = reply.from_user["id"]
    else:
        user = get_arg(message)
        if not user:
            await message.edit("**GBan Who?**")
            return
    get_user = await app.get_users(user)
    await gban_user(get_user.id)
    await message.edit(f"**Gbanned {get_user.first_name}!**")


@app.on_message(filters.command("ungban", PREFIX) & filters.me)
async def ungban(_, message):
    reply = message.reply_to_message
    if reply:
        user = reply.from_user["id"]
    else:
        user = get_arg(message)
        if not user:
            await message.edit("**Ungban Who?**")
            return
    get_user = await app.get_users(user)
    await ungban_user(get_user.id)
    await message.edit(f"**Ungbanned {get_user.first_name}!**")